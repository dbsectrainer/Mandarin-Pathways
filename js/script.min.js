async function initializeNotifications(){if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window)try{var e;"granted"===await Notification.requestPermission()&&(e=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"YOUR_VAPID_PUBLIC_KEY"}),console.log("Push notification subscription:",e))}catch(e){console.error("Error setting up push notifications:",e)}}function initializeLanguage(){setLanguage(new URLSearchParams(window.location.search).get("lang")||localStorage.getItem("preferredLanguage")||"zh-CN")}function setLanguage(t){localStorage.setItem("preferredLanguage",t),document.documentElement.lang=t,document.querySelectorAll(".language-btn").forEach(e=>{"zh"===e.dataset.lang&&"zh-CN"===t||e.dataset.lang==e.dataset.lang&&t===e.dataset.lang?e.classList.add("active"):e.classList.remove("active")})}function initializeLanguageButtons(){document.querySelectorAll(".language-btn").forEach(a=>{a.addEventListener("click",()=>{var e=a.dataset.lang,t=(setLanguage("zh"===e?"zh-CN":e),new URL(window.location.href));t.searchParams.set("lang",e),window.history.pushState({},"",t)})})}document.addEventListener("DOMContentLoaded",function(){initializeNotifications(),initializeLanguage(),generateDayGrid(),initializeLanguageCards(),initializeScrollAnimations(),initializeDayPagination(),initializeMicroInteractions(),initializeLanguageButtons();let e=document.querySelector(".hero-section");var t;e&&((t=new Image).onload=function(){e.classList.add("loaded")},t.src="https://images.unsplash.com/photo-1546410531-89436e5b419a?auto=format&fit=crop&w=900&q=75"),document.querySelectorAll("section").forEach(e=>{e.classList.contains("hero-section")||(e.style.contentVisibility="auto",e.style.containIntrinsicSize="500px")})});let currentDayPage=1,daysPerPage=10,totalDays=40,selectedLanguage=localStorage.getItem("preferredLanguage")||"zh-CN";function generateDayGrid(){var t=document.querySelector(".day-grid"),a=(t.innerHTML="",(currentDayPage-1)*daysPerPage+1),n=Math.min(a+daysPerPage-1,totalDays);document.getElementById("dayRangeStart")&&(document.getElementById("dayRangeStart").textContent=a,document.getElementById("dayRangeEnd").textContent=n);for(let e=a;e<=n;e++){var i=document.createElement("a"),r="zh-CN"===selectedLanguage?"zh":selectedLanguage,r=(i.href=`day.html?day=${e}&lang=`+r,i.className="animate-fade-in hover-scale",i.style.animationDelay=.05*(e-a)+"s",document.createElement("div")),o=(r.className="day-number",r.textContent=e,document.createElement("div"));o.className="day-status",o.innerHTML='<i class="fas fa-circle" style="color: var(--warning-color);"></i>',e<=7?addDayTooltip(i,"Pinyin system, tones, and pronunciation basics"):e<=14?addDayTooltip(i,"Essential daily phrases and basic grammar"):e<=22?addDayTooltip(i,"Cultural context and daily life communication"):e<=30?addDayTooltip(i,"Professional and business Mandarin"):addDayTooltip(i,"Advanced fluency and real-world applications"),i.appendChild(r),i.appendChild(o),t.appendChild(i)}updateProgress(0)}function initializeDayPagination(){var e=document.getElementById("prevDays"),t=document.getElementById("nextDays");e&&t&&(e.addEventListener("click",function(){1<currentDayPage&&(currentDayPage--,generateDayGrid(),document.querySelector(".day-grid").classList.add("animate-fade-in"),setTimeout(()=>{document.querySelector(".day-grid").classList.remove("animate-fade-in")},800))}),t.addEventListener("click",function(){currentDayPage<Math.ceil(totalDays/daysPerPage)&&(currentDayPage++,generateDayGrid(),document.querySelector(".day-grid").classList.add("animate-fade-in"),setTimeout(()=>{document.querySelector(".day-grid").classList.remove("animate-fade-in")},800))}))}function addDayTooltip(e,t){e.setAttribute("title",t)}function initializeLanguageCards(){var e=document.querySelectorAll(".language-card");let n={zh:"zh-CN",pinyin:"en",en:"en"};e.forEach((e,t)=>{let a=Object.keys(n)[t];a&&(e.addEventListener("click",function(){var e=n[a];document.querySelectorAll(".language-card").forEach(e=>{e.style.opacity="0.7",e.style.transform="none"}),this.style.opacity="1",this.style.transform="translateY(-10px)",setLanguage(e),updateDayGridLanguage(a),document.querySelector("#day-selection").scrollIntoView({behavior:"smooth",block:"start"})}),e.addEventListener("mouseenter",function(){"0.7"!==this.style.opacity&&(this.style.transform="translateY(-10px)",this.style.boxShadow="0 15px 30px rgba(0,0,0,0.15)")}),e.addEventListener("mouseleave",function(){"0.7"!==this.style.opacity&&(this.style.transform="translateY(0)",this.style.boxShadow="0 10px 20px rgba(0,0,0,0.1)")}))})}function updateDayGridLanguage(a){document.querySelectorAll(".day-grid a").forEach(e=>{var t=e.querySelector(".day-number").textContent;e.href=`day.html?day=${t}&lang=`+a})}function initializeScrollAnimations(){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.contains("section-card")?e.target.classList.add("animate-slide-right"):e.target.classList.contains("benefit-card")?e.target.classList.add("animate-slide-left"):e.target.classList.add("animate-fade-in"),t.unobserve(e.target))})},{threshold:.1});document.querySelectorAll("section, .language-card, .section-card, .benefit-card, .section-divider").forEach(e=>{e.classList.contains("animate-fade-in")||e.classList.contains("animate-slide-right")||e.classList.contains("animate-slide-left")||t.observe(e)}),document.querySelectorAll(".visual-anchor").forEach(e=>{e.classList.add("animate-float")})}function initializeMicroInteractions(){document.querySelectorAll(".section-divider").forEach(e=>{e.classList.add("animate-pulse")}),document.querySelectorAll(".benefit-card").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.background="linear-gradient(135deg, white, #f8f9fa)"}),e.addEventListener("mouseleave",function(){this.style.background="white"})}),document.querySelectorAll(".section-card").forEach((e,t)=>{e.addEventListener("mouseenter",function(){this.style.borderLeftWidth="8px"}),e.addEventListener("mouseleave",function(){this.style.borderLeftWidth="4px"})})}function updateProgress(t){var e=document.querySelectorAll(".progress-fill");let a=t/40*100;e.forEach(e=>{e.style.width=a+"%"}),document.querySelectorAll(".progress-container p").forEach(e=>{e.textContent=`Progress: Day ${t}/40`})}function formatDate(e){var t=document.documentElement.lang;return new Intl.DateTimeFormat("zh-CN"===t?"zh-CN":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(e)}function handleError(e){console.error("An error occurred:",e);var e=document.querySelector("main"),t=document.createElement("div"),a=(t.className="error animate-fade-in",document.documentElement.lang);t.innerHTML="zh-CN"===a?'<span class="zh">发生错误。请稍后再试。</span>':'<span class="en">An error occurred. Please try again later.</span>',e.prepend(t)}